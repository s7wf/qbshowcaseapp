import React, { useState, useEffect, useMemo, useCallback } from 'react';
import { initializeApp } from 'firebase/app';
import { 
    getAuth, 
    signInWithCustomToken, 
    onAuthStateChanged,
    signInAnonymously
} from 'firebase/auth';
import { 
    getFirestore, 
    collection, 
    onSnapshot, 
    addDoc, 
    doc,
    query,
    serverTimestamp,
    writeBatch
} from 'firebase/firestore';
import { BarChart, Bar, XAxis, YAxis, Tooltip, Legend, ResponsiveContainer, CartesianGrid } from 'recharts';
import { Home, ArrowRightLeft, DollarSign, Menu, X, ShieldCheck, Upload, AlertTriangle, Lightbulb, CheckCircle, PlusCircle } from 'lucide-react';

// --- Firebase Configuration ---
// These global variables are provided by the Canvas environment.
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-quickbooks-clone';
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

// --- Firebase Initialization ---
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// --- Helper & Utility Components ---

const Modal = ({ isOpen, onClose, title, children }) => {
    if (!isOpen) return null;
    return (
        <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4">
            <div className="bg-white rounded-lg shadow-xl w-full max-w-md">
                <div className="p-4 border-b flex justify-between items-center">
                    <h3 className="text-lg font-semibold text-gray-800">{title}</h3>
                    <button onClick={onClose} className="text-gray-500 hover:text-gray-800"><X size={24} /></button>
                </div>
                <div className="p-6">{children}</div>
            </div>
        </div>
    );
};

const StatCard = ({ title, value, icon, color }) => (
    <div className="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4 transition-transform hover:scale-105">
        <div className={`p-3 rounded-full ${color}`}>{icon}</div>
        <div>
            <p className="text-sm font-medium text-gray-500">{title}</p>
            <p className="text-2xl font-bold text-gray-800">{value}</p>
        </div>
    </div>
);

// --- Main Application Components ---

const Sidebar = ({ currentView, setView, isSidebarOpen, setSidebarOpen }) => {
    const navItems = [
        { name: 'Dashboard', icon: <Home size={20} />, view: 'dashboard' },
        { name: 'Transactions', icon: <ArrowRightLeft size={20} />, view: 'transactions' },
        { name: 'Security', icon: <ShieldCheck size={20} />, view: 'security' },
    ];
    
    const navLinkClasses = (view) => 
        `flex items-center space-x-3 px-4 py-3 rounded-lg cursor-pointer transition-colors ${
            currentView === view 
                ? 'bg-indigo-600 text-white font-semibold shadow-md' 
                : 'text-gray-600 hover:bg-indigo-50 hover:text-indigo-600'
        }`;

    return (
        <>
            <div className={`fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden ${isSidebarOpen ? 'block' : 'hidden'}`} onClick={() => setSidebarOpen(false)}></div>
            <aside className={`fixed top-0 left-0 h-full bg-white border-r border-gray-200 w-64 p-4 z-40 transform transition-transform md:relative md:translate-x-0 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                <div className="flex items-center space-x-2 mb-8">
                    <ShieldCheck className="text-indigo-600" size={32} />
                    <h1 className="text-2xl font-bold text-gray-800">SecurDash</h1>
                </div>
                <nav className="space-y-2">
                    {navItems.map(item => (
                        <a key={item.name} onClick={() => { setView(item.view); setSidebarOpen(false); }} className={navLinkClasses(item.view)}>
                            {item.icon}<span>{item.name}</span>
                        </a>
                    ))}
                </nav>
                <div className="absolute bottom-4 left-4 right-4 p-4 bg-indigo-50 rounded-lg text-center">
                    <p className="text-sm text-indigo-700">Showcase for Intuit</p>
                    <p className="text-xs text-indigo-500">Enhanced with SecOps & AI</p>
                </div>
            </aside>
        </>
    );
};

const Dashboard = ({ transactions, vulnerabilities }) => {
    const financialStats = useMemo(() => {
        const totalRevenue = transactions.filter(t => t.type === 'invoice').reduce((sum, t) => sum + t.amount, 0);
        const totalExpenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
        return { totalRevenue, totalExpenses, netProfit: totalRevenue - totalExpenses };
    }, [transactions]);

    const securityStats = useMemo(() => {
        const highRisk = vulnerabilities.filter(v => v.cvssScore && v.cvssScore >= 7.0).length;
        const mediumRisk = vulnerabilities.filter(v => v.cvssScore && v.cvssScore >= 4.0 && v.cvssScore < 7.0).length;
        return { totalVulnerabilities: vulnerabilities.length, highRisk, mediumRisk };
    }, [vulnerabilities]);

    const formatCurrency = (value) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);

    return (
        <div className="space-y-8">
            <div>
                <h2 className="text-3xl font-bold text-gray-800 mb-4">Financial Overview</h2>
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <StatCard title="Total Revenue" value={formatCurrency(financialStats.totalRevenue)} icon={<DollarSign size={24} className="text-green-500" />} color="bg-green-100" />
                    <StatCard title="Total Expenses" value={formatCurrency(financialStats.totalExpenses)} icon={<DollarSign size={24} className="text-red-500" />} color="bg-red-100" />
                    <StatCard title="Net Profit" value={formatCurrency(financialStats.netProfit)} icon={<DollarSign size={24} className="text-indigo-500" />} color="bg-indigo-100" />
                </div>
            </div>
            <div>
                <h2 className="text-3xl font-bold text-gray-800 mb-4">Security Posture</h2>
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <StatCard title="Total Vulnerabilities" value={securityStats.totalVulnerabilities} icon={<ShieldCheck size={24} className="text-blue-500" />} color="bg-blue-100" />
                    <StatCard title="High-Risk Alerts" value={securityStats.highRisk} icon={<AlertTriangle size={24} className="text-red-500" />} color="bg-red-100" />
                    <StatCard title="Medium-Risk Alerts" value={securityStats.mediumRisk} icon={<AlertTriangle size={24} className="text-yellow-500" />} color="bg-yellow-100" />
                </div>
            </div>
        </div>
    );
};

// --- Security Components ---
const SecurityDashboard = ({ vulnerabilities, onDataIngested, userId }) => {
    const [isProcessing, setIsProcessing] = useState(false);
    const [error, setError] = useState(null);

    const handleFileUpload = async (event) => {
        const file = event.target.files[0];
        if (!file) return;

        setIsProcessing(true);
        setError(null);

        try {
            const content = await file.text();
            // Sample JSON structure: [{ "cveId": "CVE-2021-44228", "source": "Internal Scan" }, { "cveId": "CVE-2022-22965", "source": "External Pentest" }]
            const scannerData = JSON.parse(content);
            
            const enrichedDataPromises = scannerData.map(async (item) => {
                try {
                    const response = await fetch(`https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=${item.cveId}`);
                    if (!response.ok) {
                        console.error(`Failed to fetch NVD data for ${item.cveId}: ${response.statusText}`);
                        return { ...item, error: `NVD data not found (${response.status})` };
                    }
                    const cveDetails = await response.json();
                    const cve = cveDetails.vulnerabilities[0]?.cve;
                    const cvssV3 = cve?.metrics?.cvssMetricV31?.[0]?.cvssData;

                    return {
                        ...item,
                        description: cve?.descriptions?.find(d => d.lang === 'en')?.value || 'No description available.',
                        cvssScore: cvssV3?.baseScore || null,
                        severity: cvssV3?.baseSeverity || 'UNKNOWN',
                        attackVector: cvssV3?.attackVector || 'N/A',
                    };
                } catch(e) {
                    console.error(`Error processing NVD data for ${item.cveId}:`, e);
                    return {...item, error: 'Failed to process NVD data.'}
                }
            });
            let enrichedData = await Promise.all(enrichedDataPromises);
            
            const aiAnalyzedDataPromises = enrichedData.map(async (item) => {
                if (item.error) return item;

                const prompt = `As a cybersecurity analyst, provide a brief, easy-to-understand risk summary and a recommended action for the following vulnerability.
                Vulnerability: ${item.cveId} (${item.description})
                CVSS Score: ${item.cvssScore} (${item.severity})
                Respond in JSON format with two keys: "riskSummary" and "recommendedAction".`;
                
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    const result = await response.json();
                    
                    const rawText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (rawText) {
                        const aiText = rawText.replace(/```json\n?|```/g, '').trim();
                        if (aiText) {
                            const aiJson = JSON.parse(aiText);
                            return { ...item, ...aiJson, aiAnalyzed: true };
                        } else {
                            console.error("AI Analysis returned empty text for:", item.cveId);
                        }
                    } else {
                         console.error("No text in AI response for:", item.cveId, "Response:", result);
                    }
                } catch (aiError) { 
                    console.error("AI Analysis Error:", aiError);
                }
                return { ...item, riskSummary: "AI analysis failed.", recommendedAction: "Review manually.", aiAnalyzed: false };
            });
            const finalData = await Promise.all(aiAnalyzedDataPromises);
            
            await onDataIngested(finalData);

        } catch (err) {
            setError('Failed to parse or process file. Please ensure it is a valid JSON.');
            console.error(err);
        } finally {
            setIsProcessing(false);
            if(event.target) {
               event.target.value = null;
            }
        }
    };

    const getSeverityColor = (severity) => {
        switch(severity) {
            case 'CRITICAL': return 'bg-red-700 text-white';
            case 'HIGH': return 'bg-red-500 text-white';
            case 'MEDIUM': return 'bg-yellow-500 text-black';
            case 'LOW': return 'bg-green-500 text-white';
            default: return 'bg-gray-400 text-black';
        }
    };
    
    return (
        <div className="space-y-6">
            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <h2 className="text-3xl font-bold text-gray-800">Security Center</h2>
                <label htmlFor="file-upload" className={`inline-flex items-center space-x-2 bg-indigo-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-indigo-700 transition-colors cursor-pointer ${isProcessing ? 'opacity-50' : ''}`}>
                    {isProcessing ? <div className="w-5 h-5 border-t-2 border-white border-solid rounded-full animate-spin"></div> : <Upload size={20} />}
                    <span>{isProcessing ? 'Processing...' : 'Ingest Scanner Data'}</span>
                    <input id="file-upload" type="file" className="hidden" onChange={handleFileUpload} accept=".json" disabled={isProcessing} />
                </label>
            </div>

            {error && <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md" role="alert"><p>{error}</p></div>}
            
            <div className="space-y-4">
                {vulnerabilities.length > 0 ? (
                    vulnerabilities.map(vuln => (
                        <div key={vuln.id} className="bg-white p-4 rounded-lg shadow-md border-l-4" style={{borderColor: getSeverityColor(vuln.severity).split(' ')[0].replace('bg-','-')}}>
                             <div className="flex flex-col sm:flex-row justify-between sm:items-center mb-2">
                                <h3 className="text-lg font-bold text-gray-900">{vuln.cveId}</h3>
                                <span className={`px-3 py-1 text-sm font-semibold rounded-full ${getSeverityColor(vuln.severity)}`}>
                                    {vuln.severity} ({vuln.cvssScore || 'N/A'})
                                </span>
                            </div>
                            <p className="text-sm text-gray-600 mb-4">{vuln.description}</p>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="bg-gray-50 p-3 rounded-lg">
                                    <h4 className="font-semibold text-gray-800 flex items-center gap-2"><Lightbulb size={16} className="text-indigo-500"/> AI Risk Summary</h4>
                                    <p className="text-sm text-gray-700 mt-1">{vuln.riskSummary || 'Not analyzed.'}</p>
                                </div>
                                <div className="bg-gray-50 p-3 rounded-lg">
                                    <h4 className="font-semibold text-gray-800 flex items-center gap-2"><CheckCircle size={16} className="text-green-500"/> AI Recommended Action</h4>
                                    <p className="text-sm text-gray-700 mt-1">{vuln.recommendedAction || 'Not analyzed.'}</p>
                                </div>
                            </div>
                            <p className="text-xs text-gray-400 mt-3">Source: {vuln.source}</p>
                        </div>
                    ))
                ) : (
                    <div className="text-center py-12 text-gray-500 bg-white rounded-lg shadow-md">
                        <ShieldCheck size={48} className="mx-auto text-gray-300"/>
                        <p className="mt-4">No vulnerabilities found. Upload a scanner report to begin.</p>
                        <p className="text-xs mt-2 text-gray-400">{'Sample JSON: `[{"cveId": "CVE-2021-44228"}]`'}</p>
                    </div>
                )}
            </div>
        </div>
    );
};

// --- Transaction Components (Restored) ---
const TransactionForm = ({ onAddTransaction, closeModal }) => {
    const [description, setDescription] = useState('');
    const [amount, setAmount] = useState('');
    const [type, setType] = useState('invoice');
    const [date, setDate] = useState(new Date().toISOString().split('T')[0]);

    const handleSubmit = async (e) => {
        e.preventDefault();
        if (!description || !amount || isNaN(parseFloat(amount))) {
            console.error("Please fill in all fields with valid data.");
            return;
        }
        const newTransaction = { description, amount: parseFloat(amount), type, date, createdAt: serverTimestamp() };
        await onAddTransaction(newTransaction);
        closeModal();
    };

    return (
        <form onSubmit={handleSubmit} className="space-y-4">
            <div>
                <label htmlFor="description" className="block text-sm font-medium text-gray-700">Description</label>
                <input id="description" type="text" value={description} onChange={(e) => setDescription(e.target.value)} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., Web Design Project" />
            </div>
            <div>
                <label htmlFor="amount" className="block text-sm font-medium text-gray-700">Amount</label>
                <input id="amount" type="number" step="0.01" value={amount} onChange={(e) => setAmount(e.target.value)} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="1500.00" />
            </div>
            <div>
                <label htmlFor="type" className="block text-sm font-medium text-gray-700">Type</label>
                <select id="type" value={type} onChange={(e) => setType(e.target.value)} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    <option value="invoice">Invoice (Income)</option>
                    <option value="expense">Expense</option>
                </select>
            </div>
             <div>
                <label htmlFor="date" className="block text-sm font-medium text-gray-700">Date</label>
                <input id="date" type="date" value={date} onChange={(e) => setDate(e.target.value)} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" />
            </div>
            <div className="flex justify-end space-x-2 pt-4">
                <button type="button" onClick={closeModal} className="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Cancel</button>
                <button type="submit" className="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Add Transaction</button>
            </div>
        </form>
    );
};

const TransactionsList = ({ transactions, onAddTransaction }) => {
    const [isModalOpen, setModalOpen] = useState(false);
    const formatCurrency = (value) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
    const sortedTransactions = useMemo(() => [...transactions].sort((a, b) => new Date(b.date) - new Date(a.date)), [transactions]);

    return (
        <div className="space-y-6">
            <div className="flex justify-between items-center">
                <h2 className="text-3xl font-bold text-gray-800">Transactions</h2>
                <button onClick={() => setModalOpen(true)} className="flex items-center space-x-2 bg-indigo-600 text-white px-4 py-2 rounded-lg shadow-md hover:bg-indigo-700 transition-colors">
                    <PlusCircle size={20} /><span>Add Transaction</span>
                </button>
            </div>
            <div className="bg-white rounded-xl shadow-md overflow-hidden">
                <div className="overflow-x-auto">
                    <table className="min-w-full divide-y divide-gray-200">
                        <thead className="bg-gray-50">
                            <tr>
                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                <th scope="col" className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                            </tr>
                        </thead>
                        <tbody className="bg-white divide-y divide-gray-200">
                             {sortedTransactions.length > 0 ? (
                                sortedTransactions.map(t => (
                                    <tr key={t.id} className="hover:bg-gray-50">
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{t.date}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{t.description}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm"><span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.type === 'invoice' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>{t.type}</span></td>
                                        <td className={`px-6 py-4 whitespace-nowrap text-sm text-right font-medium ${t.type === 'invoice' ? 'text-green-600' : 'text-red-600'}`}>{formatCurrency(t.amount)}</td>
                                    </tr>
                                ))
                             ) : (
                                <tr><td colSpan="4" className="text-center py-10 text-gray-500">You haven't added any transactions yet.</td></tr>
                             )}
                        </tbody>
                    </table>
                </div>
            </div>
            <Modal isOpen={isModalOpen} onClose={() => setModalOpen(false)} title="Add New Transaction">
                <TransactionForm onAddTransaction={onAddTransaction} closeModal={() => setModalOpen(false)} />
            </Modal>
        </div>
    );
};


// --- App Container ---
export default function App() {
    const [userId, setUserId] = useState(null);
    const [transactions, setTransactions] = useState([]);
    const [vulnerabilities, setVulnerabilities] = useState([]);
    const [loading, setLoading] = useState(true);
    const [currentView, setCurrentView] = useState('dashboard');
    const [isSidebarOpen, setSidebarOpen] = useState(false);

    useEffect(() => {
        const handleAuth = async () => {
            try {
                if (initialAuthToken) await signInWithCustomToken(auth, initialAuthToken);
                else await signInAnonymously(auth);
            } catch (error) {
                console.error("Authentication Error, falling back to anonymous:", error);
                await signInAnonymously(auth);
            }
        };
        handleAuth();
        const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
            setUserId(currentUser ? currentUser.uid : null);
            setTimeout(() => setLoading(false), 500);
        });
        return () => unsubscribe();
    }, []);

    useEffect(() => {
        if (!userId) return;
        const transCollectionPath = `/artifacts/${appId}/users/${userId}/transactions`;
        const transQuery = query(collection(db, transCollectionPath));
        const unsubscribeTrans = onSnapshot(transQuery, (snapshot) => setTransactions(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))), (error) => console.error("Error fetching transactions:", error));

        const vulnCollectionPath = `/artifacts/${appId}/users/${userId}/vulnerabilities`;
        const vulnQuery = query(collection(db, vulnCollectionPath));
        const unsubscribeVuln = onSnapshot(vulnQuery, (snapshot) => {
            const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            const severityOrder = { 'CRITICAL': 1, 'HIGH': 2, 'MEDIUM': 3, 'LOW': 4, 'UNKNOWN': 5 };
            data.sort((a,b) => (severityOrder[a.severity] || 99) - (severityOrder[b.severity] || 99));
            setVulnerabilities(data);
        }, (error) => console.error("Error fetching vulnerabilities:", error));

        return () => { unsubscribeTrans(); unsubscribeVuln(); };
    }, [userId]);

    const handleDataIngested = useCallback(async (vulnerabilityData) => {
        if (!userId) {
            console.error("Cannot add data: No user logged in.");
            return;
        }
        try {
            const vulnCollectionRef = collection(db, `/artifacts/${appId}/users/${userId}/vulnerabilities`);
            const batch = writeBatch(db);

            vulnerabilityData.forEach(item => {
                const docRef = doc(vulnCollectionRef); 
                batch.set(docRef, { ...item, ingestedAt: serverTimestamp() });
            });
            await batch.commit();

        } catch (error) {
            console.error("Error batch writing documents: ", error);
        }
    }, [userId]);
    
    const handleAddTransaction = useCallback(async (transactionData) => {
        if (!userId) return;
        try {
            await addDoc(collection(db, `/artifacts/${appId}/users/${userId}/transactions`), transactionData);
        } catch (error) {
            console.error("Error adding transaction: ", error);
        }
    }, [userId]);

    if (loading) {
        return (
            <div className="flex items-center justify-center h-screen bg-gray-100">
                <div className="text-center">
                    <ShieldCheck className="text-indigo-600 animate-spin" size={48} />
                    <p className="mt-4 text-lg text-gray-600">Loading Your Security Dashboard...</p>
                </div>
            </div>
        );
    }
    
    const renderContent = () => {
        switch(currentView) {
            case 'dashboard':
                return <Dashboard transactions={transactions} vulnerabilities={vulnerabilities} />;
            case 'transactions':
                return <TransactionsList transactions={transactions} onAddTransaction={handleAddTransaction} />;
            case 'security':
                return <SecurityDashboard vulnerabilities={vulnerabilities} onDataIngested={handleDataIngested} userId={userId} />;
            default:
                return <Dashboard transactions={transactions} vulnerabilities={vulnerabilities} />;
        }
    };

    return (
        <div className="flex h-screen bg-gray-50 font-sans">
            <Sidebar currentView={currentView} setView={setCurrentView} isSidebarOpen={isSidebarOpen} setSidebarOpen={setSidebarOpen} />
            <main className="flex-1 flex flex-col overflow-y-auto">
                 <header className="md:hidden sticky top-0 bg-white/80 backdrop-blur-sm z-20 p-4 border-b flex justify-between items-center">
                    <button onClick={() => setSidebarOpen(true)} className="text-gray-600"><Menu size={24} /></button>
                    <div className="flex items-center space-x-2">
                         <ShieldCheck className="text-indigo-600" size={24} />
                         <h1 className="text-lg font-bold text-gray-800">SecurDash</h1>
                    </div>
                 </header>
                 <div className="p-4 sm:p-6 lg:p-8 flex-1">
                     {userId && <p className="text-xs text-gray-400 mb-4">User ID: {userId}</p>}
                    {renderContent()}
                 </div>
            </main>
        </div>
    );
}
